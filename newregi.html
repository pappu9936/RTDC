<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Student Registration (Firebase)</title>
<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
<link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">
<style>
body { background:#f0f2f5; padding:20px; }
h2 { text-align:center; margin-bottom:20px; }
.card-data { margin-bottom:15px; padding:15px; border-radius:10px; background:white; box-shadow:0 3px 8px rgba(0,0,0,0.1); }
.card-data:hover { box-shadow:0 5px 12px rgba(0,0,0,0.2); }
img { max-width:50px; max-height:50px; border-radius:5px; }
.highlight { background: yellow; }
@media(min-width:768px){
  .card-data { display:flex; flex-wrap:wrap; align-items:center; }
  .card-data div { flex:1 1 150px; margin-bottom:5px; }
}
</style>
</head>
<body>
<div class="container">
  <h2>Student Registration (Firebase)</h2>

  <!-- Registration Form -->
  <form id="regForm" class="bg-white p-4 rounded shadow-sm mb-4">
    <div class="row g-3">
      <div class="col-md-2"><label class="form-label">Reg No</label><input class="form-control" id="regNo" readonly></div>
      <div class="col-md-2"><label class="form-label">Title</label>
        <select class="form-select" id="title" required><option value="">Select</option><option>Mr.</option><option>Ms.</option><option>Mrs.</option></select>
      </div>
      <div class="col-md-4"><label class="form-label">Student Name</label><input class="form-control" id="name" required></div>
      <div class="col-md-4"><label class="form-label">Father Name</label><input class="form-control" id="father" required></div>
      <div class="col-md-4"><label class="form-label">Mother Name</label><input class="form-control" id="mother" required></div>
      <div class="col-md-2"><label class="form-label">DOB</label><input class="form-control" type="date" id="dob" required></div>
      <div class="col-md-3"><label class="form-label">Student Mobile</label><input class="form-control" id="stdMobile" required></div>
      <div class="col-md-3"><label class="form-label">Father Mobile</label><input class="form-control" id="fatherMobile" required></div>
      <div class="col-md-6"><label class="form-label">Address</label><input class="form-control" id="address" required></div>
      <div class="col-md-2"><label class="form-label">Pin Code</label><input class="form-control" id="pin" value="274305" required></div>
      <div class="col-md-3"><label class="form-label">High Education</label>
        <select class="form-select" id="highEdu"><option value="">Select</option><option>High School</option><option>Intermediate</option><option>Bachelor</option><option>Master</option></select>
      </div>
      <div class="col-md-3"><label class="form-label">Course</label>
        <select class="form-select" id="course"><option value="">Select</option><option>Science</option><option>Commerce</option><option>Arts</option><option>Computer</option><option>Other</option></select>
      </div>
      <div class="col-md-3"><label class="form-label">Admission Date</label><input class="form-control" type="date" id="admissionDate" required></div>
      <div class="col-md-3"><label class="form-label">Photo</label><input class="form-control" type="file" id="photo" accept="image/*" onchange="previewPhoto(event)"><img id="photoPreview" style="max-width:50px; max-height:50px; display:none;"></div>
    </div>
    <div class="mt-3"><button type="submit" class="btn btn-primary">Submit</button></div>
  </form>

  <!-- Filter + Data Buttons -->
  <div class="mb-3">
    <button class="btn btn-success me-2" onclick="toggleData()">Data</button>
    <button class="btn btn-warning me-2" onclick="exportCSV()">Export CSV</button>
    <button class="btn btn-danger me-2" onclick="bulkDelete()">Bulk Delete Selected</button>
    <select id="filterCourse" class="form-select d-inline-block w-auto me-2" onchange="searchAndPaginate()">
      <option value="">Filter by Course</option><option>Science</option><option>Commerce</option><option>Arts</option><option>Computer</option><option>Other</option>
    </select>
    <select id="filterHighEdu" class="form-select d-inline-block w-auto" onchange="searchAndPaginate()">
      <option value="">Filter by High Education</option><option>High School</option><option>Intermediate</option><option>Bachelor</option><option>Master</option>
    </select>
  </div>

  <!-- Data Section -->
  <div id="dataSection" style="display:none;">
    <input type="text" id="search" class="form-control mb-3" placeholder="Search by name..." onkeyup="searchAndPaginate()">
    <div id="cardsContainer"></div>
    <div id="pagination" class="mt-3 text-center"></div>
  </div>
</div>

<!-- Edit Modal -->
<div class="modal fade" id="editModal" tabindex="-1">
  <div class="modal-dialog modal-lg">
    <div class="modal-content">
      <div class="modal-header"><h5 class="modal-title">Edit Student</h5><button type="button" class="btn-close" data-bs-dismiss="modal"></button></div>
      <div class="modal-body">
        <form id="editForm" class="row g-3">
          <div class="col-md-2"><label class="form-label">Reg No</label><input class="form-control" id="e_regNo" readonly></div>
          <div class="col-md-2"><label class="form-label">Title</label>
            <select class="form-select" id="e_title" required><option value="">Select</option><option>Mr.</option><option>Ms.</option><option>Mrs.</option></select>
          </div>
          <div class="col-md-4"><label class="form-label">Student Name</label><input class="form-control" id="e_name" required></div>
          <div class="col-md-4"><label class="form-label">Father Name</label><input class="form-control" id="e_father" required></div>
          <div class="col-md-4"><label class="form-label">Mother Name</label><input class="form-control" id="e_mother" required></div>
          <div class="col-md-2"><label class="form-label">DOB</label><input class="form-control" type="date" id="e_dob" required></div>
          <div class="col-md-3"><label class="form-label">Student Mobile</label><input class="form-control" id="e_stdMobile" required></div>
          <div class="col-md-3"><label class="form-label">Father Mobile</label><input class="form-control" id="e_fatherMobile" required></div>
          <div class="col-md-6"><label class="form-label">Address</label><input class="form-control" id="e_address" required></div>
          <div class="col-md-2"><label class="form-label">Pin Code</label><input class="form-control" id="e_pin" required></div>
          <div class="col-md-3"><label class="form-label">High Education</label>
            <select class="form-select" id="e_highEdu"><option value="">Select</option><option>High School</option><option>Intermediate</option><option>Bachelor</option><option>Master</option></select>
          </div>
          <div class="col-md-3"><label class="form-label">Course</label>
            <select class="form-select" id="e_course"><option value="">Select</option><option>Science</option><option>Commerce</option><option>Arts</option><option>Computer</option><option>Other</option></select>
          </div>
          <div class="col-md-3"><label class="form-label">Admission Date</label><input class="form-control" type="date" id="e_admissionDate" required></div>
          <div class="col-md-3"><label class="form-label">Photo</label><input class="form-control" type="file" id="e_photo" accept="image/*" onchange="previewEditPhoto(event)"><img id="e_photoPreview" style="max-width:50px; max-height:50px; display:none;"></div>
        </form>
      </div>
      <div class="modal-footer">
        <button class="btn btn-primary" onclick="saveEdit()">Save Changes</button>
      </div>
    </div>
  </div>
</div>

<!-- Firebase SDK -->
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-database-compat.js"></script>

<script>
const firebaseConfig = {
  apiKey: "YOUR_API_KEY",
  authDomain: "YOUR_PROJECT_ID.firebaseapp.com",
  databaseURL: "https://YOUR_PROJECT_ID-default-rtdb.firebaseio.com",
  projectId: "YOUR_PROJECT_ID",
  storageBucket: "YOUR_PROJECT_ID.appspot.com",
  messagingSenderId: "YOUR_SENDER_ID",
  appId: "YOUR_APP_ID"
};
firebase.initializeApp(firebaseConfig);
const db = firebase.database();

let editId=null, currentPage=1, rowsPerPage=10, filteredData=[];

// Auto generate regNo & admissionDate
function generateRegNo(){ return "NK" + (new Date().getTime()%100000); }
document.getElementById("regNo").value = generateRegNo();
document.getElementById("admissionDate").valueAsDate = new Date();

// Preview photo
function previewPhoto(e){ let p=document.getElementById("photoPreview"); p.src=URL.createObjectURL(e.target.files[0]); p.style.display='block'; }
function previewEditPhoto(e){ let p=document.getElementById("e_photoPreview"); p.src=URL.createObjectURL(e.target.files[0]); p.style.display='block'; }

// Submit form
document.getElementById("regForm").addEventListener("submit", function(e){
  e.preventDefault();
  let regNo=document.getElementById("regNo").value;
  let fields=['title','name','father','mother','dob','stdMobile','fatherMobile','address','pin','highEdu','course','admissionDate'];
  let student={regNo};
  fields.forEach(f=>student[f]=document.getElementById(f).value);
  let photoFile=document.getElementById("photo").files[0];
  if(photoFile){ let reader=new FileReader(); reader.onload=function(){ student.photo=reader.result; saveToFirebase(student); }; reader.readAsDataURL(photoFile); } else saveToFirebase(student);

  function saveToFirebase(student){
    let newRef=db.ref("students").push();
    newRef.set(student,()=>{ alert("Data submitted successfully"); document.getElementById("regForm").reset(); document.getElementById("regNo").value=generateRegNo(); document.getElementById("admissionDate").valueAsDate=new Date(); document.getElementById("photoPreview").style.display='none'; });
  }
});

// Fetch live data
db.ref("students").on("value", snapshot=>{
  let data=snapshot.val()||{};
  filteredData=Object.keys(data).map(key=>({id:key,...data[key]}));
  searchAndPaginate();
});

// Toggle data section
function toggleData(){ let sec=document.getElementById("dataSection"); sec.style.display=(sec.style.display==="none"?"block":"none"); searchAndPaginate(); }

// Search & paginate
function searchAndPaginate(page=1){
  currentPage=page;
  let input=document.getElementById("search").value.toLowerCase();
  let fc=document.getElementById("filterCourse").value;
  let fe=document.getElementById("filterHighEdu").value;
  let data=filteredData.filter(s=>{ let match=s.name.toLowerCase().includes(input); if(fc) match=match&&s.course===fc; if(fe) match=match&&s.highEdu===fe; return match; });
  displayPage(data);
}

// Display page with pagination and checkboxes
function displayPage(data){
  let container=document.getElementById("cardsContainer"); container.innerHTML="";
  let start=(currentPage-1)*rowsPerPage; let pageData=data.slice(start,start+rowsPerPage);
  pageData.forEach((s,i)=>{
    let srNo=start+i+1;
    let card=document.createElement("div"); card.className="card-data";
    card.innerHTML=`<input type="checkbox" class="bulkCheck me-1" data-id="${s.id}"><div><b>SR No:</b>${srNo}</div><div><b>Reg:</b>${s.regNo}</div><div><b>Title:</b>${s.title}</div><div><b>Name:</b>${s.name}</div><div><b>Father:</b>${s.father}</div><div><b>Mother:</b>${s.mother}</div><div><b>DOB:</b>${s.dob}</div><div><b>Std Mobile:</b>${s.stdMobile}</div><div><b>Father Mobile:</b>${s.fatherMobile}</div><div><b>Address:</b>${s.address}</div><div><b>Pin:</b>${s.pin}</div><div><b>High Edu:</b>${s.highEdu}</div><div><b>Course:</b>${s.course}</div><div><b>Admission Date:</b>${s.admissionDate}</div><div>${s.photo?'<img src="'+s.photo+'">':''}</div><div class="mt-2"><button class="btn btn-warning btn-sm me-1" onclick="editData('${s.id}')"><i class="fa fa-edit"></i></button><button class="btn btn-danger btn-sm me-1" onclick="deleteData('${s.id}')"><i class="fa fa-trash"></i></button><button class="btn btn-primary btn-sm" onclick="printData('${s.id}')"><i class="fa fa-print"></i></button></div>`;
    container.appendChild(card);
  });
  // Pagination
  let totalPages=Math.ceil(data.length/rowsPerPage); let pagination=document.getElementById("pagination"); pagination.innerHTML="";
  if(totalPages<=1) return;
  for(let i=1;i<=totalPages;i++){ let btn=document.createElement("button"); btn.className="btn btn-sm btn-outline-primary me-1"; if(i===currentPage) btn.classList.add("active"); btn.innerText=i; btn.onclick=function(){ searchAndPaginate(i); }; pagination.appendChild(btn); }
}

// Edit / Save
function editData(id){ editId=id; let s=filteredData.find(x=>x.id===id); ['regNo','title','name','father','mother','dob','stdMobile','fatherMobile','address','pin','highEdu','course','admissionDate'].forEach(f=>document.getElementById('e_'+f).value=s[f]); document.getElementById('e_photoPreview').style.display=s.photo?'block':'none'; document.getElementById('e_photoPreview').src=s.photo||''; new bootstrap.Modal(document.getElementById('editModal')).show(); }
function saveEdit(){ if(!editId) return; let s={}; ['title','name','father','mother','dob','stdMobile','fatherMobile','address','pin','highEdu','course','admissionDate'].forEach(f=>s[f]=document.getElementById('e_'+f).value); let photoFile=document.getElementById('e_photo').files[0]; if(photoFile){ let reader=new FileReader(); reader.onload=function(){ s.photo=reader.result; db.ref("students/"+editId).update(s); editId=null; bootstrap.Modal.getInstance(document.getElementById('editModal')).hide(); }; reader.readAsDataURL(photoFile); } else { db.ref("students/"+editId).update(s); editId=null; bootstrap.Modal.getInstance(document.getElementById('editModal')).hide(); } }

// Delete
function deleteData(id){ if(confirm("Delete this record?")) db.ref("students/"+id).remove(); }
function bulkDelete(){ let checks=document.querySelectorAll('.bulkCheck:checked'); if(checks.length===0){ alert("Select records first"); return; } if(confirm("Delete selected records?")){ checks.forEach(c=>db.ref("students/"+c.dataset.id).remove()); } }

// Print
function printData(id){ let s=filteredData.find(x=>x.id===id); if(!s) return; let w=window.open("","Print","width=800,height=600"); w.document.write("<h2>Student Details</h2>"); for(let key in s){ if(key!=="photo"&&key!=="id") w.document.write(`<p><b>${key}:</b>${s[key]}</p>`); } if(s.photo) w.document.write(`<img src="${s.photo}" style="max-width:150px;max-height:150px;">`); w.print(); }

// CSV
function exportCSV(){ if(filteredData.length===0){ alert("No data to export"); return; } let csv="SRNo,RegNo,Title,Name,Father,Mother,DOB,StdMobile,FatherMobile,Address,Pin,HighEdu,Course,AdmissionDate\n"; filteredData.forEach((s,i)=>{ let sr=i+1; csv+=`"${sr}","${s.regNo}","${s.title}","${s.name}","${s.father}","${s.mother}","${s.dob}","${s.stdMobile}","${s.fatherMobile}","${s.address}","${s.pin}","${s.highEdu}","${s.course}","${s.admissionDate}"\n`; }); let blob=new Blob([csv],{type:"text/csv"}); let url=URL.createObjectURL(blob); let a=document.createElement("a"); a.href=url; a.download="students.csv"; a.click(); URL.revokeObjectURL(url); }
</script>
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/js/all.min.js"></script>
</body>
</html>
